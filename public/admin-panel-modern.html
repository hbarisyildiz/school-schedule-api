<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ« Okul YÃ¶netim Sistemi - Admin Panel</title>
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="admin-panel.css">
</head>
<body>
    <div id="app" class="app">
        
        <!-- ========== LOGIN SCREEN ========== -->
        <div v-if="showLogin && !user" class="login-overlay">
            <div class="login-container">
                <div class="login-header">
                    <div class="login-icon">ğŸ«</div>
                    <h1>Okul YÃ¶netim Sistemi</h1>
                    <p>HesabÄ±nÄ±za giriÅŸ yapÄ±n</p>
                </div>
                
                <form @submit.prevent="login" class="login-form">
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-icon">ğŸ“§</div>
                            <input 
                                type="email" 
                                v-model="loginForm.email" 
                                placeholder="E-posta adresiniz"
                                required
                                class="form-input"
                            >
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="input-group">
                            <div class="input-icon">ğŸ”’</div>
                            <input 
                                type="password" 
                                v-model="loginForm.password" 
                                placeholder="Åifreniz"
                                required
                                class="form-input"
                            >
                        </div>
                    </div>
                    
                    <button type="submit" class="login-btn" :disabled="isLoggingIn">
                        <span v-if="isLoggingIn">GiriÅŸ yapÄ±lÄ±yor...</span>
                        <span v-else>GiriÅŸ Yap</span>
                    </button>
                    
                    <div v-if="loginError" class="error-message">
                        {{ loginError }}
                    </div>
                </form>
                
                <!-- Quick Login Section -->
                <div class="quick-login">
                    <div class="divider">
                        <span>HÄ±zlÄ± Test GiriÅŸi</span>
                    </div>
                    
                    <div class="quick-login-buttons">
                        <button @click="quickLogin('admin@schoolschedule.com')" class="quick-btn admin">
                            <div class="quick-btn-icon">ğŸ‘‘</div>
                            <div class="quick-btn-text">
                                <div class="quick-btn-title">Super Admin</div>
                                <div class="quick-btn-subtitle">admin123</div>
                            </div>
                        </button>
                        
                        <button @click="quickLogin('mudur@ataturklisesi.edu.tr')" class="quick-btn manager">
                            <div class="quick-btn-icon">ğŸ“</div>
                            <div class="quick-btn-text">
                                <div class="quick-btn-title">Okul MÃ¼dÃ¼rÃ¼</div>
                                <div class="quick-btn-subtitle">mudur123</div>
                            </div>
                        </button>
                        
                        <button @click="quickLogin('ayse.yilmaz@ataturklisesi.edu.tr')" class="quick-btn teacher">
                            <div class="quick-btn-icon">ğŸ‘©â€ğŸ«</div>
                            <div class="quick-btn-text">
                                <div class="quick-btn-title">Ã–ÄŸretmen</div>
                                <div class="quick-btn-subtitle">teacher123</div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ========== MAIN CONTENT ========== -->
        <div v-if="!showLogin && user">
            
            <!-- Header -->
            <div class="header">
                <div class="flex-between">
                    <div>
                        <h1>ğŸ« HoÅŸ Geldiniz, {{ user.name }}</h1>
                        <p>{{ user.role?.display_name }} - {{ user.school?.name || 'Sistem YÃ¶neticisi' }}</p>
                    </div>
                    <button @click="logout" class="btn btn-danger">Ã‡Ä±kÄ±ÅŸ Yap</button>
                </div>
            </div>
            
            <!-- Messages -->
            <div v-if="message" class="success">{{ message }}</div>
            <div v-if="error" class="error">{{ error }}</div>
            
            <!-- Navigation Tabs -->
            <div class="tabs">
                <button 
                    @click="changeTab('dashboard')" 
                    :class="['btn', {active: activeTab === 'dashboard'}]"
                >
                    ğŸ“Š Dashboard
                </button>
                
                <!-- Sadece Super Admin iÃ§in Okullar sekmesi -->
                <button 
                    v-if="user.role?.name === 'super_admin'"
                    @click="changeTab('schools')" 
                    :class="['btn', {active: activeTab === 'schools'}]"
                >
                    ğŸ« Okullar
                </button>
                
                <button 
                    @click="changeTab('users')" 
                    :class="['btn', {active: activeTab === 'users'}]"
                >
                    ğŸ‘¥ KullanÄ±cÄ±lar
                </button>
                <button 
                    @click="changeTab('classes')" 
                    :class="['btn', {active: activeTab === 'classes'}]"
                >
                    ğŸ›ï¸ SÄ±nÄ±flar
                </button>
                <button 
                    @click="changeTab('subjects')" 
                    :class="['btn', {active: activeTab === 'subjects'}]"
                >
                    ğŸ“š Dersler
                </button>
                <button 
                    @click="changeTab('schedules')" 
                    :class="['btn', {active: activeTab === 'schedules'}]"
                >
                    ğŸ“… Ders ProgramlarÄ±
                </button>
            </div>
            
            <!-- ========== DASHBOARD TAB ========== -->
            <div v-if="activeTab === 'dashboard'" class="card">
                <h2>ğŸ“Š Genel BakÄ±ÅŸ</h2>
                
                <!-- Super Admin Dashboard -->
                <div v-if="user.role?.name === 'super_admin'" class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                        <h3>Toplam Okullar</h3>
                        <div class="number">{{ stats.totalSchools || 0 }}</div>
                        <div class="label">{{ stats.activeSchools || 0 }} aktif</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #2ecc71);">
                        <h3>Toplam KullanÄ±cÄ±lar</h3>
                        <div class="number">{{ stats.totalUsers || 0 }}</div>
                        <div class="label">{{ stats.activeToday || 0 }} bugÃ¼n aktif</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                        <h3>Ã–ÄŸretmenler</h3>
                        <div class="number">{{ stats.totalTeachers || 0 }}</div>
                        <div class="label">Sistemde kayÄ±tlÄ±</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                        <h3>Ã–ÄŸrenciler</h3>
                        <div class="number">{{ stats.totalStudents || 0 }}</div>
                        <div class="label">Sistemde kayÄ±tlÄ±</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                        <h3>SÄ±nÄ±flar</h3>
                        <div class="number">{{ stats.totalClasses || 0 }}</div>
                        <div class="label">Toplam sÄ±nÄ±f</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #16a085, #1abc9c);">
                        <h3>Dersler</h3>
                        <div class="number">{{ stats.totalSubjects || 0 }}</div>
                        <div class="label">TanÄ±mlÄ± ders</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #d35400, #e67e22);">
                        <h3>Ders ProgramlarÄ±</h3>
                        <div class="number">{{ stats.totalSchedules || 0 }}</div>
                        <div class="label">OluÅŸturulmuÅŸ program</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #2c3e50, #34495e);">
                        <h3>Bu Ay</h3>
                        <div class="number">{{ stats.schoolsThisMonth || 0 }}</div>
                        <div class="label">Yeni okul kaydÄ±</div>
                    </div>
                </div>
                
                <!-- School Admin Dashboard -->
                <div v-else class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                        <h3>Okul AdÄ±</h3>
                        <div class="number" style="font-size: 20px;">{{ stats.schoolName || '-' }}</div>
                        <div class="label">Abonelik: {{ stats.subscriptionPlan || 'Basic' }}</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                        <h3>Ã–ÄŸretmenler</h3>
                        <div class="number">{{ stats.totalTeachers || 0 }}</div>
                        <div class="label">KayÄ±tlÄ± Ã¶ÄŸretmen</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                        <h3>Ã–ÄŸrenciler</h3>
                        <div class="number">{{ stats.totalStudents || 0 }}</div>
                        <div class="label">KayÄ±tlÄ± Ã¶ÄŸrenci</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                        <h3>SÄ±nÄ±flar</h3>
                        <div class="number">{{ stats.totalClasses || 0 }}</div>
                        <div class="label">{{ stats.activeClasses || 0 }} aktif</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #16a085, #1abc9c);">
                        <h3>Dersler</h3>
                        <div class="number">{{ stats.totalSubjects || 0 }}</div>
                        <div class="label">TanÄ±mlÄ± ders</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #2ecc71);">
                        <h3>Ders ProgramlarÄ±</h3>
                        <div class="number">{{ stats.totalSchedules || 0 }}</div>
                        <div class="label">{{ stats.activeSchedules || 0 }} aktif</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #d35400, #e67e22);">
                        <h3>Abonelik SÃ¼resi</h3>
                        <div class="number">{{ stats.daysLeft || 0 }}</div>
                        <div class="label">{{ stats.subscriptionEndsAt || '-' }} tarihine kadar</div>
                    </div>
                    
                    <div class="stat-card" style="background: linear-gradient(135deg, #2c3e50, #34495e);">
                        <h3>Bildirimler</h3>
                        <div class="number">{{ stats.unreadNotifications || 0 }}</div>
                        <div class="label">OkunmamÄ±ÅŸ bildirim</div>
                    </div>
                </div>
            </div>
            
            <!-- ========== SCHOOLS TAB ========== -->
            <div v-if="activeTab === 'schools'" class="card">
                <div class="flex-between mb-20">
                    <h2>ğŸ« Okullar</h2>
                    <div class="flex gap-10">
                        <input 
                            v-model="searchQuery" 
                            type="text" 
                            placeholder="Ara..." 
                            style="width: 250px;"
                        >
                        <select v-model="filterStatus" style="width: 150px;">
                            <option value="all">TÃ¼mÃ¼</option>
                            <option value="active">Aktif</option>
                            <option value="expired">SÃ¼resi DolmuÅŸ</option>
                        </select>
                        <button @click="openAddSchoolModal" class="btn btn-success">+ Okul Ekle</button>
                    </div>
                </div>
                
                <div v-if="schoolsLoading" class="text-center">
                    <div class="spinner"></div>
                    <p>YÃ¼kleniyor...</p>
                </div>
                
                <div v-else-if="filteredSchools.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ«</div>
                    <h3>Okul BulunamadÄ±</h3>
                    <p>HenÃ¼z kayÄ±tlÄ± okul bulunmamaktadÄ±r.</p>
                </div>
                
                <div v-else class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Okul AdÄ±</th>
                                <th>Email</th>
                                <th>Ä°l/Ä°lÃ§e</th>
                                <th>Abonelik</th>
                                <th>Durum</th>
                                <th>Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="school in filteredSchools" :key="school.id">
                                <td>{{ school.name }}</td>
                                <td>{{ school.email }}</td>
                                <td>{{ school.city?.name }} / {{ school.district?.name }}</td>
                                <td>{{ school.subscription_plan?.name || 'Basic' }}</td>
                                <td>
                                    <span :class="['status-badge', school.is_active ? 'status-active' : 'status-inactive']">
                                        {{ school.is_active ? 'Aktif' : 'Pasif' }}
                                    </span>
                                </td>
                                <td class="actions">
                                    <button @click="viewSchool(school)" class="btn btn-info btn-small">Detay</button>
                                    <button @click="editSchool(school)" class="btn btn-primary btn-small">DÃ¼zenle</button>
                                    <button @click="deleteSchool(school)" class="btn btn-danger btn-small">Sil</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ========== USERS TAB ========== -->
            <div v-if="activeTab === 'users'" class="card">
                <div class="flex-between mb-20">
                    <h2>ğŸ‘¥ KullanÄ±cÄ±lar</h2>
                    <div class="flex gap-10">
                        <input 
                            v-model="searchQuery" 
                            type="text" 
                            placeholder="Ara..." 
                            style="width: 250px;"
                        >
                        <div class="flex gap-10">
                            <a href="/ogretmen_sablonu.xlsx" class="btn btn-info" download>ğŸ“¥ Excel Åablonu Ä°ndir (.xlsx)</a>
                        </div>
                        <button @click="openAddUserModal" class="btn btn-success">+ KullanÄ±cÄ± Ekle</button>
                    </div>
                </div>
                
                <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3498db;">
                    <div class="flex-between">
                        <div>
                            <strong>ğŸ“Š Toplu Ã–ÄŸretmen YÃ¼kleme</strong>
                            <p style="margin: 5px 0 0 0; font-size: 14px; color: #666;">
                                Excel/CSV ÅŸablonunu indirin â†’ Ã–ÄŸretmen bilgilerini doldurun â†’ YÃ¼kleyin
                            </p>
                        </div>
                        <div class="flex gap-10">
                            <input 
                                type="file" 
                                ref="excelFile" 
                                @change="handleExcelFile" 
                                accept=".xlsx,.xls,.csv" 
                                style="display: none;"
                            >
                            <button @click="$refs.excelFile.click()" class="btn btn-success">
                                ğŸ“¤ Excel/CSV YÃ¼kle
                            </button>
                        </div>
                    </div>
                    <div v-if="isUploadingExcel" style="margin-top: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border-width: 2px; margin: 0; display: inline-block; vertical-align: middle;"></div>
                        <span style="color: #3498db; margin-left: 10px;">Ã–ÄŸretmenler yÃ¼kleniyor...</span>
                    </div>
                    <div style="margin-top: 10px; font-size: 13px; color: #888;">
                        â„¹ï¸ Gerekli alanlar: Ad Soyad, Email, BranÅŸ | VarsayÄ±lan ÅŸifre: <code>123456</code> | Max: 2MB
                    </div>
                </div>
                
                <div v-if="usersLoading" class="text-center">
                    <div class="spinner"></div>
                    <p>YÃ¼kleniyor...</p>
                </div>
                
                <div v-else-if="filteredUsers.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ‘¥</div>
                    <h3>KullanÄ±cÄ± BulunamadÄ±</h3>
                    <p>HenÃ¼z kayÄ±tlÄ± kullanÄ±cÄ± bulunmamaktadÄ±r.</p>
                </div>
                
                <div v-else class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ad Soyad</th>
                                <th>Email</th>
                                <th>Rol</th>
                                <th>Okul</th>
                                <th>Durum</th>
                                <th>Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="user in filteredUsers" :key="user.id">
                                <td>{{ user.name }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.role?.display_name }}</td>
                                <td>{{ user.school?.name || '-' }}</td>
                                <td>
                                    <span :class="['status-badge', user.is_active ? 'status-active' : 'status-inactive']">
                                        {{ user.is_active ? 'Aktif' : 'Pasif' }}
                                    </span>
                                </td>
                                <td class="actions">
                                    <button @click="editUser(user)" class="btn btn-primary btn-small">DÃ¼zenle</button>
                                    <button @click="deleteUser(user)" class="btn btn-danger btn-small">Sil</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ========== CLASSES TAB ========== -->
            <div v-if="activeTab === 'classes'" class="card">
                <div class="flex-between mb-20">
                    <h2>ğŸ›ï¸ SÄ±nÄ±flar</h2>
                    <div class="flex gap-10">
                        <input 
                            v-model="searchQuery" 
                            type="text" 
                            placeholder="Ara..." 
                            style="width: 250px;"
                        >
                        <button @click="openAddClassModal" class="btn btn-success">+ SÄ±nÄ±f Ekle</button>
                    </div>
                </div>
                
                <div v-if="classesLoading" class="text-center">
                    <div class="spinner"></div>
                    <p>YÃ¼kleniyor...</p>
                </div>
                
                <div v-else-if="classes.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ›ï¸</div>
                    <h3>SÄ±nÄ±f BulunamadÄ±</h3>
                    <p>HenÃ¼z tanÄ±mlÄ± sÄ±nÄ±f bulunmamaktadÄ±r.</p>
                    <button @click="openAddClassModal" class="btn btn-success">Ä°lk SÄ±nÄ±fÄ± Ekle</button>
                </div>
                
                <div v-else class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>SÄ±nÄ±f</th>
                                <th>Seviye</th>
                                <th>Åube</th>
                                <th>SÄ±nÄ±f Ã–ÄŸretmeni</th>
                                <th>Durum</th>
                                <th>Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="classItem in classes" :key="classItem.id">
                                <td><strong>{{ classItem.name }}</strong></td>
                                <td>{{ classItem.grade }}. SÄ±nÄ±f</td>
                                <td>{{ classItem.branch || '-' }}</td>
                                <td>{{ classItem.class_teacher?.name || '-' }}</td>
                                <td>
                                    <span :class="['status-badge', classItem.is_active ? 'status-active' : 'status-inactive']">
                                        {{ classItem.is_active ? 'Aktif' : 'Pasif' }}
                                    </span>
                                </td>
                                <td class="actions">
                                    <button @click="editClass(classItem)" class="btn btn-primary btn-small">DÃ¼zenle</button>
                                    <button @click="deleteClass(classItem)" class="btn btn-danger btn-small">Sil</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ========== SUBJECTS TAB ========== -->
            <div v-if="activeTab === 'subjects'" class="card">
                <div class="flex-between mb-20">
                    <h2>ğŸ“š Dersler</h2>
                    <button @click="openAddSubjectModal" class="btn btn-success">+ Ders Ekle</button>
                </div>
                
                <div v-if="subjectsLoading" class="text-center">
                    <div class="spinner"></div>
                    <p>YÃ¼kleniyor...</p>
                </div>
                
                <div v-else-if="subjects.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ“š</div>
                    <h3>Ders BulunamadÄ±</h3>
                    <p>HenÃ¼z tanÄ±mlÄ± ders bulunmamaktadÄ±r.</p>
                </div>
                
                <div v-else class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ders AdÄ±</th>
                                <th>Kod</th>
                                <th>HaftalÄ±k Saat</th>
                                <th>AÃ§Ä±klama</th>
                                <th>Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="subject in subjects" :key="subject.id">
                                <td>{{ subject.name }}</td>
                                <td>{{ subject.code }}</td>
                                <td>{{ subject.weekly_hours }}</td>
                                <td>{{ subject.description || '-' }}</td>
                                <td class="actions">
                                    <button @click="editSubject(subject)" class="btn btn-primary btn-small">DÃ¼zenle</button>
                                    <button @click="deleteSubject(subject)" class="btn btn-danger btn-small">Sil</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- ========== SCHEDULES TAB ========== -->
            <div v-if="activeTab === 'schedules'" class="card">
                <h2>ğŸ“… Ders ProgramlarÄ±</h2>
                
                <div v-if="schedulesLoading" class="text-center">
                    <div class="spinner"></div>
                    <p>YÃ¼kleniyor...</p>
                </div>
                
                <div v-else-if="schedules.length === 0" class="empty-state">
                    <div class="empty-state-icon">ğŸ“…</div>
                    <h3>Ders ProgramÄ± BulunamadÄ±</h3>
                    <p>HenÃ¼z oluÅŸturulmuÅŸ ders programÄ± bulunmamaktadÄ±r.</p>
                </div>
                
                <div v-else class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Ders</th>
                                <th>Ã–ÄŸretmen</th>
                                <th>SÄ±nÄ±f</th>
                                <th>GÃ¼n</th>
                                <th>Saat</th>
                                <th>Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="schedule in schedules" :key="schedule.id">
                                <td>{{ schedule.subject?.name }}</td>
                                <td>{{ schedule.teacher?.name }}</td>
                                <td>{{ schedule.class?.name }}</td>
                                <td>{{ schedule.day_of_week }}</td>
                                <td>{{ schedule.start_time }} - {{ schedule.end_time }}</td>
                                <td class="actions">
                                    <button @click="editSchedule(schedule)" class="btn btn-primary btn-small">DÃ¼zenle</button>
                                    <button @click="deleteSchedule(schedule)" class="btn btn-danger btn-small">Sil</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
        </div>
        
        <!-- ========== MODALS ========== -->
        
        <!-- Edit School Modal -->
        <div v-if="editSchoolModal" class="modal-overlay" @click.self="editSchoolModal = false">
            <div class="modal">
                <button @click="editSchoolModal = false" class="close-btn">Ã—</button>
                <h2>ğŸ« Okul DÃ¼zenle</h2>
                
                <div class="form-group">
                    <label>Okul AdÄ±:</label>
                    <input v-model="editSchoolData.name" type="text">
                </div>
                
                <div class="form-group">
                    <label>Email:</label>
                    <input v-model="editSchoolData.email" type="email">
                </div>
                
                <div class="form-group">
                    <label>Telefon:</label>
                    <input v-model="editSchoolData.phone" type="text">
                </div>
                
                <div class="form-group">
                    <label>Website:</label>
                    <input v-model="editSchoolData.website" type="text">
                </div>
                
                <div class="modal-footer">
                    <button @click="editSchoolModal = false" class="btn btn-danger">Ä°ptal</button>
                    <button @click="updateSchool" class="btn btn-success">GÃ¼ncelle</button>
                </div>
            </div>
        </div>
        
        <!-- View School Modal -->
        <div v-if="viewSchoolModal" class="modal-overlay" @click.self="viewSchoolModal = false">
            <div class="modal">
                <button @click="viewSchoolModal = false" class="close-btn">Ã—</button>
                <h2>ğŸ« Okul DetaylarÄ±</h2>
                
                <div v-if="selectedSchool">
                    <p><strong>Ad:</strong> {{ selectedSchool.name }}</p>
                    <p><strong>Email:</strong> {{ selectedSchool.email }}</p>
                    <p><strong>Telefon:</strong> {{ selectedSchool.phone || '-' }}</p>
                    <p><strong>Ä°l/Ä°lÃ§e:</strong> {{ selectedSchool.city?.name }} / {{ selectedSchool.district?.name }}</p>
                    <p><strong>Abonelik:</strong> {{ selectedSchool.subscription_plan?.name }}</p>
                    <p><strong>Durum:</strong> {{ selectedSchool.is_active ? 'Aktif' : 'Pasif' }}</p>
                </div>
                
                <div class="modal-footer">
                    <button @click="viewSchoolModal = false" class="btn btn-primary">Kapat</button>
                </div>
            </div>
        </div>
        
        <!-- Add School Modal -->
        <div v-if="addSchoolModal" class="modal-overlay" @click.self="addSchoolModal = false">
            <div class="modal">
                <button @click="addSchoolModal = false" class="close-btn">Ã—</button>
                <h2>ğŸ« Yeni Okul Ekle</h2>
                
                <div class="form-group">
                    <label>Okul AdÄ±: *</label>
                    <input v-model="newSchool.name" type="text" placeholder="Ã–rn: AtatÃ¼rk Lisesi" required>
                </div>
                
                <div class="form-group">
                    <label>E-posta: * (Okul yÃ¶neticisi iÃ§in)</label>
                    <input v-model="newSchool.email" type="email" placeholder="mudur@okul.edu.tr" required>
                </div>
                
                <div class="form-group">
                    <label>Åifre: * (Ä°lk yÃ¶netici iÃ§in)</label>
                    <input v-model="newSchool.password" type="password" placeholder="Minimum 6 karakter" required>
                </div>
                
                <div class="form-group">
                    <label>Telefon:</label>
                    <input v-model="newSchool.phone" type="text" placeholder="(555) 123-4567">
                </div>
                
                <div class="form-group">
                    <label>Ä°l: *</label>
                    <select v-model="newSchool.city_id" @change="loadDistrictsForCity" required>
                        <option value="">Ä°l SeÃ§iniz</option>
                        <option v-for="city in cities" :key="city.id" :value="city.id">
                            {{ city.name }}
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Ä°lÃ§e: *</label>
                    <select v-model="newSchool.district_id" :disabled="!newSchool.city_id || isLoadingDistricts" required>
                        <option value="">{{ isLoadingDistricts ? 'YÃ¼kleniyor...' : 'Ä°lÃ§e SeÃ§iniz' }}</option>
                        <option v-for="district in districts" :key="district.id" :value="district.id">
                            {{ district.name }}
                        </option>
                    </select>
                    <small v-if="isLoadingDistricts" style="color: #3498db; display: block; margin-top: 5px;">
                        â³ Ä°lÃ§eler yÃ¼kleniyor...
                    </small>
                </div>
                
                <div class="form-group">
                    <label>Website:</label>
                    <input v-model="newSchool.website" type="text" placeholder="https://okul.edu.tr">
                </div>
                
                <div class="form-group">
                    <label>Abonelik PlanÄ±: *</label>
                    <select v-model="newSchool.subscription_plan_id" required>
                        <option value="">Plan SeÃ§iniz</option>
                        <option v-for="plan in subscriptionPlans" :key="plan.id" :value="plan.id">
                            {{ plan.name }} - {{ plan.monthly_price }}â‚º/ay
                        </option>
                    </select>
                </div>
                
                <!-- Error Message -->
                <div v-if="schoolModalError" class="error-message" style="margin-top: 15px;">
                    {{ schoolModalError }}
                </div>
                
                <div class="modal-footer">
                    <button @click="addSchoolModal = false" class="btn btn-danger">Ä°ptal</button>
                    <button @click="addSchool" class="btn btn-success" :disabled="isAddingSchool">
                        <span v-if="isAddingSchool">OluÅŸturuluyor...</span>
                        <span v-else>Okul OluÅŸtur</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Add User Modal -->
        <div v-if="addUserModal" class="modal-overlay" @click.self="addUserModal = false">
            <div class="modal">
                <button @click="addUserModal = false" class="close-btn">Ã—</button>
                <h2>ğŸ‘¤ KullanÄ±cÄ± Ekle</h2>
                
                <!-- Modal iÃ§i hata mesajÄ± -->
                <div v-if="modalError" class="error" style="margin-bottom: 15px;">
                    {{ modalError }}
                </div>
                
                <div class="form-group">
                    <label>Ad Soyad: *</label>
                    <input v-model="newUser.name" @input="generateShortName" type="text" placeholder="Ã–rn: Ahmet YÄ±lmaz" required>
                </div>
                
                <div class="form-group">
                    <label>KÄ±sa Ad: (Otomatik, dÃ¼zenlenebilir)</label>
                    <input 
                        v-model="newUser.short_name" 
                        @input="newUser.short_name = newUser.short_name.toUpperCase()"
                        type="text" 
                        maxlength="6" 
                        placeholder="AHMTYL" 
                        style="text-transform: uppercase;"
                    >
                    <small style="color: #7f8c8d; font-size: 12px;">ğŸ“ Otomatik oluÅŸturulur, istediÄŸiniz gibi deÄŸiÅŸtirebilirsiniz (max 6 karakter)</small>
                </div>
                
                <div class="form-group">
                    <label>Email: *</label>
                    <input v-model="newUser.email" type="email" placeholder="ogretmen@okul.edu.tr" required>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Åifre: *</label>
                        <input v-model="newUser.password" type="password" placeholder="Min 6 karakter" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Åifre Tekrar: *</label>
                        <input v-model="newUser.password_confirmation" type="password" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Rol: *</label>
                    <select v-model="newUser.role_id" required>
                        <option value="">SeÃ§iniz</option>
                        <option v-for="role in roles" :key="role.id" :value="role.id">
                            {{ role.display_name }}
                        </option>
                    </select>
                </div>
                
                <div class="form-group" v-if="isTeacherRole(newUser.role_id)">
                    <label>BranÅŸ: * (Ã–ÄŸretmenler iÃ§in)</label>
                    <input v-model="newUser.branch" type="text" placeholder="Ã–rn: Matematik, TÃ¼rkÃ§e, Fen Bilgisi" required>
                </div>
                
                <div class="form-group">
                    <label>Telefon:</label>
                    <input v-model="newUser.phone" type="text" placeholder="(555) 123-4567">
                </div>
                
                <div class="modal-footer">
                    <button @click="addUserModal = false" class="btn btn-danger">Ä°ptal</button>
                    <button @click="addUser" class="btn btn-success">Ekle</button>
                </div>
            </div>
        </div>
        
        <!-- Edit User Modal -->
        <div v-if="editUserModal" class="modal-overlay" @click.self="editUserModal = false">
            <div class="modal">
                <button @click="editUserModal = false" class="close-btn">Ã—</button>
                <h2>ğŸ‘¤ KullanÄ±cÄ± DÃ¼zenle</h2>
                
                <!-- Modal iÃ§i hata mesajÄ± -->
                <div v-if="modalError" class="error" style="margin-bottom: 15px;">
                    {{ modalError }}
                </div>
                
                <div class="form-group">
                    <label>Ad Soyad:</label>
                    <input v-model="editUserData.name" type="text">
                </div>
                
                <div class="form-group" v-if="editUserData.role?.name === 'teacher'">
                    <label>KÄ±sa Ad:</label>
                    <input 
                        v-model="editUserData.short_name" 
                        @input="editUserData.short_name = editUserData.short_name.toUpperCase()"
                        type="text" 
                        maxlength="6"
                        style="text-transform: uppercase;"
                    >
                </div>
                
                <div class="form-group" v-if="editUserData.role?.name === 'teacher'">
                    <label>BranÅŸ:</label>
                    <input v-model="editUserData.branch" type="text" placeholder="Ã–rn: Matematik">
                </div>
                
                <div class="form-group">
                    <label>Email:</label>
                    <input v-model="editUserData.email" type="email">
                </div>
                
                <div class="form-group">
                    <label>Telefon:</label>
                    <input v-model="editUserData.phone" type="text">
                </div>
                
                <div class="modal-footer">
                    <button @click="editUserModal = false" class="btn btn-danger">Ä°ptal</button>
                    <button @click="updateUser" class="btn btn-success">GÃ¼ncelle</button>
                </div>
            </div>
        </div>
        
        <!-- Add Class Modal -->
        <div v-if="addClassModal" class="modal-overlay" @click.self="addClassModal = false">
            <div class="modal">
                <button @click="addClassModal = false" class="close-btn">Ã—</button>
                <h2>ğŸ›ï¸ Yeni SÄ±nÄ±f Ekle</h2>
                
                <!-- Modal iÃ§i hata mesajÄ± -->
                <div v-if="modalError" class="error" style="margin-bottom: 15px;">
                    {{ modalError }}
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Seviye: *</label>
                        <select v-model="newClass.grade" required>
                            <option value="">SeÃ§iniz</option>
                            <option value="9">9. SÄ±nÄ±f</option>
                            <option value="10">10. SÄ±nÄ±f</option>
                            <option value="11">11. SÄ±nÄ±f</option>
                            <option value="12">12. SÄ±nÄ±f</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Åube: *</label>
                        <input v-model="newClass.branch" type="text" placeholder="A, B, C, D" maxlength="5" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>SÄ±nÄ±f AdÄ±: *</label>
                    <input v-model="newClass.name" type="text" placeholder="Ã–rn: 9-A, 10-B" required>
                    <small style="color: #7f8c8d; font-size: 12px;">Otomatik: Seviye + Åube (Ã–rn: 9-A)</small>
                </div>
                
                <div class="form-group">
                    <label>SÄ±nÄ±f Ã–ÄŸretmeni:</label>
                    <select v-model="newClass.class_teacher_id">
                        <option value="">SeÃ§iniz (Ä°steÄŸe BaÄŸlÄ±)</option>
                        <option v-for="teacher in teachers" :key="teacher.id" :value="teacher.id">
                            {{ teacher.name }}
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>AÃ§Ä±klama:</label>
                    <textarea v-model="newClass.description" rows="3" placeholder="SÄ±nÄ±f hakkÄ±nda notlar (isteÄŸe baÄŸlÄ±)..."></textarea>
                </div>
                
                <div class="modal-footer">
                    <button @click="addClassModal = false" class="btn btn-danger">Ä°ptal</button>
                    <button @click="addClass" class="btn btn-success">SÄ±nÄ±f OluÅŸtur</button>
                </div>
            </div>
        </div>
        
        <!-- Edit Class Modal -->
        <div v-if="editClassModal" class="modal-overlay" @click.self="editClassModal = false">
            <div class="modal">
                <button @click="editClassModal = false" class="close-btn">Ã—</button>
                <h2>ğŸ›ï¸ SÄ±nÄ±f DÃ¼zenle</h2>
                
                <!-- Modal iÃ§i hata mesajÄ± -->
                <div v-if="modalError" class="error" style="margin-bottom: 15px;">
                    {{ modalError }}
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Seviye:</label>
                        <select v-model="editClassData.grade">
                            <option value="9">9. SÄ±nÄ±f</option>
                            <option value="10">10. SÄ±nÄ±f</option>
                            <option value="11">11. SÄ±nÄ±f</option>
                            <option value="12">12. SÄ±nÄ±f</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Åube:</label>
                        <input v-model="editClassData.branch" type="text" maxlength="5">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>SÄ±nÄ±f AdÄ±:</label>
                    <input v-model="editClassData.name" type="text">
                </div>
                
                <div class="form-group">
                    <label>SÄ±nÄ±f Ã–ÄŸretmeni:</label>
                    <select v-model="editClassData.class_teacher_id">
                        <option value="">SeÃ§iniz</option>
                        <option v-for="teacher in teachers" :key="teacher.id" :value="teacher.id">
                            {{ teacher.name }}
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>AÃ§Ä±klama:</label>
                    <textarea v-model="editClassData.description" rows="3"></textarea>
                </div>
                
                <div class="modal-footer">
                    <button @click="editClassModal = false" class="btn btn-danger">Ä°ptal</button>
                    <button @click="updateClass" class="btn btn-success">GÃ¼ncelle</button>
                </div>
            </div>
        </div>
        
        <!-- Add Subject Modal -->
        <div v-if="addSubjectModal" class="modal-overlay" @click.self="addSubjectModal = false">
            <div class="modal">
                <button @click="addSubjectModal = false" class="close-btn">Ã—</button>
                <h2>ğŸ“š Ders Ekle</h2>
                
                <div class="form-group">
                    <label>Ders AdÄ±:</label>
                    <input v-model="newSubject.name" type="text" required>
                </div>
                
                <div class="form-group">
                    <label>Ders Kodu:</label>
                    <input v-model="newSubject.code" type="text" required>
                </div>
                
                <div class="form-group">
                    <label>HaftalÄ±k Saat:</label>
                    <input v-model.number="newSubject.weekly_hours" type="number" min="1" max="20">
                </div>
                
                <div class="form-group">
                    <label>AÃ§Ä±klama:</label>
                    <textarea v-model="newSubject.description"></textarea>
                </div>
                
                <div class="modal-footer">
                    <button @click="addSubjectModal = false" class="btn btn-danger">Ä°ptal</button>
                    <button @click="addSubject" class="btn btn-success">Ekle</button>
                </div>
            </div>
        </div>
        
        <!-- Edit Subject Modal -->
        <div v-if="editSubjectModal" class="modal-overlay" @click.self="editSubjectModal = false">
            <div class="modal">
                <button @click="editSubjectModal = false" class="close-btn">Ã—</button>
                <h2>ğŸ“š Ders DÃ¼zenle</h2>
                
                <div class="form-group">
                    <label>Ders AdÄ±:</label>
                    <input v-model="editSubjectData.name" type="text">
                </div>
                
                <div class="form-group">
                    <label>Ders Kodu:</label>
                    <input v-model="editSubjectData.code" type="text">
                </div>
                
                <div class="form-group">
                    <label>HaftalÄ±k Saat:</label>
                    <input v-model.number="editSubjectData.weekly_hours" type="number" min="1" max="20">
                </div>
                
                <div class="form-group">
                    <label>AÃ§Ä±klama:</label>
                    <textarea v-model="editSubjectData.description"></textarea>
                </div>
                
                <div class="modal-footer">
                    <button @click="editSubjectModal = false" class="btn btn-danger">Ä°ptal</button>
                    <button @click="updateSubject" class="btn btn-success">GÃ¼ncelle</button>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Custom JavaScript -->
    <script src="admin-panel.js"></script>
</body>
</html>


